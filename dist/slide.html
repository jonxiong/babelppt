<!doctype html><html><head><meta charset=UTF-8><title>babel - By xiongyang</title><link rel=stylesheet href=//cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=//cdn.staticfile.org/prism/1.15.0/themes/prism.min.css><link rel=stylesheet href=//cdn.staticfile.org/KaTeX/0.10.0-rc.1/katex.min.css><link rel=stylesheet href=//cdn.staticfile.org/prism/1.15.0/themes/prism-dark.min.css><link href=./css/chunk-vendors.4e4765ff.css rel=stylesheet></head><body><div><article id=webslides><section slide class="slide aligncenter"><div class=wrap wrap=true><h1 class="text-landing text-shadow">babel</h1><p class=text-intro>By xiongyang</p><p><a href=https://github.com/ksky521/nodeppt class="button ghost" target=_blank><i class="fa fa-github"></i> Github</a></p></div><div class=speaker-note><div class=wrap><p>babel`beibl<br>大家好今天给大家分享我对babel一个初步的理解，有什么疑问的地方可以指出来一起探讨</p></div></div></section><section slide class="slide aligncenter"><div class=wrap wrap=true><h1 class=text-landing>What is babel</h1><div></div></div></section><section slide class="slide fullscreen"><div class=wrap wrap=true><div class="card-50 bg-white"><figure><img src=http://image.gxx365.com/babel.jpeg alt=""></figure><div class=flex-content><p>Babel的原意指得是人类为了见到上帝，准备建造的一座通天塔(babel)，上帝为了阻止人类，让他们语言变的不同。于是，人类开始有了文化差异，从而导致了冲突，塔也就建不起来了…… <cite>旧约圣经</cite></p></div></div></div><div class=speaker-note><div class=wrap><p>babel `beibl\ 的相关历史： 我第一次打开搜索引擎 查询关于Babel的资料时，出现的了很多关于 Babel 的传说还有电影 Babel的原意 指得是人类为了见到上帝，准备建造一座通天塔，上帝为了阻止人类，让他们语言变的不同。于是，人类开始有了文化差异，从而导致了冲突，塔也就建不起来了……</p><p>当我们明白了babel的作用 再回来看这个项目命名的的时候 会发现这个名字起的是非常贴切</p><p>了解完这个神话之后，下面来说在我们前端的babel</p></div></div></section><section slide class="slide aligncenter"><div class=wrap wrap=true><h2>什么是 Babel</h2><h3 class="tobuild fadeInLeft">Babel is a JavaScript compiler</h3><h3 class="tobuild fadeInLeft">Babe居然‘认识’代码、更改代码。就是操作代码的代码</h3><p><a href="https://babeljs.io/repl/#?browsers=defaults%2C%20not%20ie%2011%2C%20not%20ie_mob%2011&amp;build=&amp;builtIns=false&amp;spec=false&amp;loose=false&amp;code_lz=BQSgBAvAfGDeBQBIAxgewHYGdUBsCmAdDqgObADkADgIboAm15I8AvgNzzxpYAuY1kMAEY2QA&amp;debug=false&amp;forceAllTransforms=false&amp;shippedProposals=false&amp;circleciRepo=&amp;evaluate=false&amp;fileSize=false&amp;timeTravel=false&amp;sourceType=module&amp;lineWrap=true&amp;presets=env%2Ces2015%2Cenv&amp;prettier=false&amp;targets=&amp;version=7.10.2&amp;externalPlugins=" class="button ghost" target=_blank><i class="fa fa-github"></i> Babel</a></p></div><div class=speaker-note><div class=wrap><p>没错就一句话，Babel是一个现代JS编译器, 有很多<strong>优秀的es6,es7新语法</strong>都不能直接在<strong>支持低版本语法的浏览器</strong>中运行, 各浏览器对 JS版本的支持各不相同。为了解决这个“沟通不畅”的问题，所以就有了 Babel，Babel 的出现使得我们可以无须顾忌的去使用新的的语法</p><p>我们可以通过这个网站来看一下babel的转换</p><p>我们会发现 babel 可以认识并且更改代码</p><p>所以我们看一下babel在这中间做了什么处理？</p></div></div></section><section slide class=slide :class=size-60><div class="wrap size-60" wrap=true><h2>Babel的处理步骤</h2><hr><div class="bg-white shadow"><ul class="flexblock reasons"><li><h2>解析</h2><p>通过词法分析和语法分析，将JS源代码转换成抽象语法树AST</p></li><li><h2>转换</h2><p>对语法树AST进行转换操作，把ES2015+的部分转换为ES5</p></li><li><h2>生成</h2><p>将转换之后的语法树重新生成代码</p></li></ul></div></div><div class=speaker-note><div class=wrap><p>babel的处理步骤主要有下面这三个：</p><ol><li>解析（parse）-- 将源代码变成抽象语法树AST</li><li>转换（transform）-- 操作AST，把es6/es7等新语法的部分转换为ES5, 这部分我们可以通过配置bebel插件去操作</li><li>生成（generate）-- 将更改后的AST，再变回JS代码</li></ol><p>注意babel本身不具有任何转化功能，它把转化的功能都分解到插件里面。因此当我们不配置任何插件时，经过babel的代码和输入是相同的</p><p>我们可以来看一下babel的基本配置</p></div></div></section><section slide class=slide :class=size-80><div class="wrap size-80" wrap=true><div class="vertical-align grid"><div class=column><h3><strong>Babel的基本配置</strong></h3><ul><li><h4>plugins：transform 的载体</h4></li><li><h4>presets：预设，一系列plugins的组合</h4><ul><li>@babel/preset-env</li><li>@babel/preset-flow</li><li>@babel/preset-react</li><li>@babel/preset-typescript</li></ul></li></ul></div><div class=column><pre class=language-js><code class=language-js><span class="token comment">// babel.config.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">api</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    api<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> presets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"@babel/preset-env"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">"@babel/plugin-transform-arrow-functions"</span><span class="token punctuation">,</span>
        <span class="token string">"@babel/plugin-transform-classes"</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// 单测需要转一下es modules至commonjs</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'test:unit'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'@babel/plugin-transform-modules-commonjs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        presets<span class="token punctuation">,</span>
        plugins
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></div><hr></div><div class=speaker-note><div class=wrap><p>Babel 支持多种的配置方式,</p><ul><li>babel.config.js</li><li>.babelrc</li><li>.babelrc.js</li><li>package.json</li></ul><p>如果希望以编程的方式创建配置文件, 那么<strong>babel.config.js</strong>可以满足我们的需求，其他几种这里就不过多介绍</p><p>babel配置里面主要分成两大块： plugins 和 presets</p><p>这里配置了<strong>箭头函数</strong>和<strong>class</strong>的转换插件，这样就可以在代码里面使用它们。 但是如果在实际开发过程中，每一个插件都需要我们手动去添加，会影响效率， 为此 babel 为我们提供了presets<strong>预设</strong>就是plugins 的组合，你也可以理解为是套餐</p><p>官方提供了如下几个 @babel/preset-env 推荐使用的 @babel/preset-flow @babel/preset-react @babel/preset-typescript</p><p>介绍完基本的配置后我们来看下babel是如何进行解析和转换的这样一套相关的操作</p></div></div></section><section slide class="slide fullscreen"><div class=wrap wrap=true><div class="card-50 bg-white"><figure><img src=https://user-gold-cdn.xitu.io/2019/10/2/16d8d0cd559c7e1e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1 alt=""></figure><div class=flex-content><h3>Babel的处理流程</h3><ul><li>AST</li></ul><p><a href=https://astexplorer.net/#/Z1exs6BWMq class="button ghost" target=_blank><i class="fa fa-github"></i> AST</a></p></div></div></div><div class=speaker-note><div class=wrap><p>babel `beibl\ 如图为babel的一个处理流程： 分别与前面的处理步骤对应起来</p><ol><li>解析：对源代码词法分析和语法分析</li><li>转换：遍历AST并应用转换器增删改查AST节点</li><li>生成：将更改后的AST转换为源代码</li></ol><p>我们发现Babel插件就是作用于AST上进行的，</p><p>其实在我们开发中例如：代码压缩、代码高亮，css预处理器、eslint等其实都是基于AST来实现的，所以还是很有必要的了解一下AST</p><p>AST是什么，我们可以先通过这个网站来感受一下</p><p>我从左边输入一个常见的赋值语句，右边就展示出了这个语句的AST，有Tree和JSON两种形式，里面分成来很多个节点来表示我们这样一个赋值语句，这些节点就构成一颗语法树</p><p>在某种层面上这两边是对等的</p><p>我们只要知道通过这样一个AST语法树就可以描述我们的JS代码，具体的对应规则这里不做过多解释，感兴趣的可以下来了解</p><p>下面我对应每一个阶段 说一下babel都是怎么操作的：</p></div></div></section><section slide class=slide><div class=wrap wrap=true><div class=content-center><h2>一：解析 (Parsing)</h2><p>将代码解析成抽象语法树（AST），每个js引擎（比如V8引擎）都有自己的AST解析器</p><ul><li><h3>词法分析</h3></li><li><h3>语法解析</h3></li></ul><h3>Babylon</h3></div></div><div class=speaker-note><div class=wrap><p>一：代码解析 (Parsing) 将代码解析成抽象语法树（AST），每个js引擎（比如V8引擎）都有自己的AST解析器。</p><p>在解析过程中有两个阶段： 词法分析和语法分析， 词法分析 可以看成是对代码进行“分词”，它接收一段源代码，执行一个函数把代码分割成被称为Tokens（令牌） 的东西 ，令牌类似于AST中节点； 语法分析： 通过语法分析把 Tokens 转化为上面提到过的 AST</p><p>Babel中用的解析器是babylon/`baibilen/ 。我们来体验一下：</p><p>和我们预期的一样，得到AST了。这里我注意到还有start、end、loc这样位置信息的字段，应该可以对生成Source Map有用的字段。</p></div></div></section><section slide class=slide><div class=wrap wrap=true><div class=content-center><h2>二：转换（Transform）</h2><p>在这个阶段，Babel接收得到AST并对其进行深度优先遍历，在此过程中对节点进行添加、更新及移除操作。这部分也是Babel插件介入工作的部分</p><h3>babel-traverse</h3></div></div><div class=speaker-note><div class=wrap><p>代码转换（Transform）</p><p>在这个阶段，Babel接收得到AST并对其进行深度优先遍历，在此过程中对节点进行添加、更新及移除操作。这部分也是Babel插件介入工作的部分</p><p>Babel中的babel-traverse就是用来做转换的,继续看下demo</p><p>我们可以看到ast被更改了</p></div></div></section><section slide class=slide><div class=wrap wrap=true><div class=content-center><h2>三：生成(Generator)</h2><p>经过上面两个阶段，需要转译的代码已经经过转换，生成了新的AST，最后一个阶段就是根据这个AST来生成代码</p><h3>babel-generator</h3></div></div><div class=speaker-note><div class=wrap><p>经过上面两个阶段，需要转译的代码已经经过转换，生成了新的AST，最后一个步就是根据这个AST 来生成代码. Babel中的babel-generator对应这一步操作</p><p>在code字段里，我们可以看到里面新生成的代码</p><p>上面讲的这几个库，还有更多细节，有兴趣的同学可以再细入研究</p><p>最后 这些库的集合实现了这一整套流程，就是我们的Babel</p></div></div></section><section slide class="slide bg-black aligncenter" image="https://source.unsplash.com/UJbHNoVPZW0/ .dark"><span class="background dark" style="background-image:url('https://source.unsplash.com/UJbHNoVPZW0/')"></span><div class=wrap wrap=true><h1 class="text-landing text-shadow">Thanks</h1></div></section></article></div><script src=//cdn.staticfile.org/echarts/4.1.0-release/echarts.min.js></script><script>window.pluginsOptions = {}



document.addEventListener('DOMContentLoaded', () => {
    let isPrintMode = false;
    if(~location.search.indexOf('print-pdf')){
        isPrintMode = true;
        WebSlides.registerPlugin('scroll', function(){});
    }
    const ws = new WebSlides({
        loop: false
    })
    window.wsInstance = ws;
    if(isPrintMode){
        ws.slides.forEach(s=>s.show())
    }
}, false)</script><script src=./js/chunk-vendors.js></script><script src=./js/slide.js></script></body></html>